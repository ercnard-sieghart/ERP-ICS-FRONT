

<div class="flex h-screen bg-gradient-to-br from-[#1A4E79] to-[#75C9C8]">
  <!-- Menu lateral -->
  <app-menu></app-menu>
  
  <!-- Conte√∫do principal -->
  <main class="flex-1 p-6 overflow-auto relative">
    <!-- Loading overlay apenas no conte√∫do principal -->
    <div *ngIf="loading" class="absolute inset-0 bg-gradient-to-br from-[#1A4E79]/90 to-[#75C9C8]/90 backdrop-blur-sm z-[5] flex items-center justify-center rounded-xl">
      <div class="bg-white rounded-xl p-8 shadow-2xl text-center min-w-[280px] mx-4">
        <div class="w-16 h-16 border-4 border-[#75C9C8]/30 border-t-[#1A4E79] rounded-full mx-auto mb-6 animate-spin"></div>
        <div class="text-xl font-bold text-[#1A4E79] mb-2">Carregando...</div>
        <div class="text-base text-[#1A4E79]/70">Aguarde</div>
      </div>
    </div>
    
    <div class="bg-white/95 backdrop-blur-sm rounded-xl shadow-xl p-8 border border-white/20">
      <div class="mb-8">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] bg-clip-text text-transparent mb-3">
          Solicita√ß√£o de Compras
        </h1>
        <p class="text-[#1A4E79]/70 text-lg">Gerencie todas as solicita√ß√µes de compras da empresa</p>
      </div>
      
      <!-- Filtros -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-[#75C9C8]">
        <div class="filtros-container">
          <h4 class="text-lg font-semibold text-[#1A4E79] mb-4 flex items-center">
            <i class="po-icon po-icon-filter mr-2"></i>
            Filtros
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-[#1A4E79] mb-2">N¬∫ Solicita√ß√£o</label>
              <input 
                type="text"
                [(ngModel)]="filtros.numeroSolicitacao"
                class="w-full p-3 border border-[#75C9C8]/30 rounded-lg focus:ring-2 focus:ring-[#75C9C8] focus:border-transparent transition-all"
                placeholder="Digite o n√∫mero..."
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-[#1A4E79] mb-2">Data</label>
              <input 
                type="date"
                [(ngModel)]="filtros.data"
                class="w-full p-3 border border-[#75C9C8]/30 rounded-lg focus:ring-2 focus:ring-[#75C9C8] focus:border-transparent transition-all"
              />
            </div>
            
            <div class="autocomplete-container">
              <label class="block text-sm font-medium text-[#1A4E79] mb-2">Centro de Custo</label>
              <input 
                type="text"
                [(ngModel)]="filtros.cc"
                (input)="onCcInputChange($event)"
                (focus)="onCcInput(filtros.cc || '')"
                (blur)="onCcBlur()"
                class="w-full p-3 border border-[#75C9C8]/30 rounded-lg focus:ring-2 focus:ring-[#75C9C8] focus:border-transparent transition-all"
                placeholder="Digite o CC..."
              />
              <div *ngIf="mostrarSugestoesCc" class="sugestoes-dropdown">
                <div 
                  *ngFor="let cc of ccSugestoesFiltradas"
                  class="sugestao-item"
                  (click)="selecionarCc(cc)">
                  {{ cc }}
                </div>
              </div>
            </div>
            
            <div class="autocomplete-container">
              <label class="block text-sm font-medium text-[#1A4E79] mb-2">Contato</label>
              <input 
                type="text"
                [(ngModel)]="filtros.contato"
                (input)="onContatoInputChange($event)"
                (focus)="onContatoInput(filtros.contato || '')"
                (blur)="onContatoBlur()"
                class="w-full p-3 border border-[#75C9C8]/30 rounded-lg focus:ring-2 focus:ring-[#75C9C8] focus:border-transparent transition-all"
                placeholder="Nome do contato..."
              />
              <div *ngIf="mostrarSugestoesContato" class="sugestoes-dropdown">
                <div 
                  *ngFor="let contato of contatoSugestoesFiltradas"
                  class="sugestao-item"
                  (click)="selecionarContato(contato)">
                  {{ contato }}
                </div>
              </div>
            </div>
          </div>
          
          <div class="flex gap-3 mt-4 pt-4 border-t border-[#75C9C8]/20">
            <button 
              (click)="aplicarFiltros()"
              class="bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] text-white px-6 py-2 rounded-lg hover:shadow-lg transition-all font-medium">
              <i class="po-icon po-icon-search mr-2"></i>
              Buscar
            </button>
            <button 
              (click)="limparFiltros()"
              class="bg-white border border-[#75C9C8] text-[#1A4E79] px-6 py-2 rounded-lg hover:bg-[#75C9C8]/10 transition-all font-medium">
              <i class="po-icon po-icon-close mr-2"></i>
              Limpar
            </button>
          </div>
        </div>
      </div>

      <!-- Tabela de solicita√ß√µes -->
      <div id="secao-tabela" class="bg-white rounded-xl shadow-lg overflow-hidden border border-[#75C9C8]/20">
        <div class="bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] p-4">
          <h3 class="text-white font-semibold text-lg flex items-center">
            <i class="po-icon po-icon-table mr-2"></i>
            Lista de Solicita√ß√µes
          </h3>
        </div>
        
        <div class="p-4">
          <po-table
            id="tabela-solicitacoes"
            [p-columns]="columns"
            [p-items]="solicitacoesFiltradas"
            [p-loading]="loading"
            [p-sort]="true"
            [p-striped]="false"
            [p-selectable]="false"
            [p-show-more-disabled]="false"
            [p-height]="600"
            [p-loading-show-more]="loading"
            [p-hide-columns-manager]="true"
            (p-row-click)="onRowClick($event)">
            
            <!-- Template para linha customizada -->
            <ng-template p-table-row-template let-row let-rowIndex="rowIndex">
              <tr 
                [style.background-color]="isRowSelected(row) ? 'rgba(117, 201, 200, 0.2)' : ''"
                [style.border-left]="isRowSelected(row) ? '4px solid #75C9C8' : ''"
                [style.box-shadow]="isRowSelected(row) ? '0 2px 8px rgba(117, 201, 200, 0.3)' : ''"
                style="cursor: pointer; transition: all 0.3s ease;"
                (click)="onRowClick({row: row})"
                (dblclick)="abrirModalCopia(row)">
                
                <!-- C√©lulas das colunas -->
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  <strong style="color: #1A4E79;">{{ row.numeroSolicitacao }}</strong>
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  {{ row.dataSolicitacao }}
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  {{ row.solicitante }}
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  {{ row.departamento }}
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  <span 
                    class="px-3 py-1 rounded-full text-xs font-medium border"
                    [ngClass]="getStatusClass(row.status)">
                    {{ getStatusLabel(row.status) }}
                  </span>
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  <span style="font-weight: bold; color: #1A4E79;">
                    {{ row.valorTotal | currency:'BRL':'symbol':'1.2-2' }}
                  </span>
                </td>
                
                <td style="padding: 12px 8px; border-bottom: 1px solid #e5e5e5;">
                  {{ row.observacoes }}
                </td>
              </tr>
            </ng-template>
            
            <!-- Template customizado para status (fallback) -->
            <ng-template p-table-column-template="status" let-row let-value>
              <span 
                class="px-3 py-1 rounded-full text-xs font-medium border"
                [ngClass]="getStatusClass(value)">
                {{ getStatusLabel(value) }}
              </span>
            </ng-template>
            
            <!-- Template customizado para valor -->
            <ng-template p-table-column-template="valorTotal" let-value>
              <span class="font-bold text-[#1A4E79]">
                {{ value | currency:'BRL':'symbol':'1.2-2' }}
              </span>
            </ng-template>
            
            <!-- Estado vazio -->
            <ng-template p-table-no-data>
              <div class="text-center py-12">
                <div class="text-[#75C9C8] text-8xl mb-6">üìã</div>
                <h3 class="text-xl font-bold text-[#1A4E79] mb-3">
                  Nenhuma solicita√ß√£o encontrada
                </h3>
                <p class="text-[#1A4E79]/60 mb-6 max-w-md mx-auto">
                  N√£o h√° solicita√ß√µes de compras para exibir no momento.
                </p>
                <button class="bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] text-white px-8 py-3 rounded-lg hover:shadow-lg transition-all font-medium">
                  <i class="po-icon po-icon-refresh mr-2"></i>
                  Atualizar Lista
                </button>
              </div>
            </ng-template>
          </po-table>
        </div>
      </div>

      <!-- Modal de Edi√ß√£o - Centralizado no viewport -->
      <div *ngIf="showEditModal" class="fixed inset-0 bg-gradient-to-br from-[#1A4E79]/90 to-[#75C9C8]/90 backdrop-blur-sm z-[9999] flex items-center justify-center p-4" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important;">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg max-h-[90vh] overflow-hidden animate-fade-in-scale">
          <!-- Header do Modal -->
          <div class="bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] p-3 sm:p-4 rounded-t-lg">
            <h2 class="text-sm sm:text-lg font-bold text-white flex items-center">
              <i class="po-icon po-icon-edit mr-1 sm:mr-2 text-sm sm:text-base"></i>
              Copiar Solicita√ß√£o
            </h2>
          </div>

          <!-- Corpo do Modal -->
          <div class="p-3 sm:p-4 max-h-[calc(95vh-120px)] sm:max-h-[calc(90vh-120px)] overflow-y-auto">
            <form #formEdicao="ngForm">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3">
                <!-- N√∫mero da Solicita√ß√£o -->
                <div>
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">N√∫mero *</label>
                  <input 
                    type="text"
                    [(ngModel)]="registroEdicao.numeroSolicitacao"
                    name="numeroSolicitacao"
                    required
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                    placeholder="SOL-000000"
                  />
                </div>

                <!-- Data da Solicita√ß√£o -->
                <div>
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Data *</label>
                  <input 
                    type="date"
                    [(ngModel)]="registroEdicao.dataSolicitacao"
                    name="dataSolicitacao"
                    required
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                  />
                </div>

                <!-- Solicitante -->
                <div class="sm:col-span-1 col-span-1">
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Solicitante *</label>
                  <input 
                    type="text"
                    [(ngModel)]="registroEdicao.solicitante"
                    name="solicitante"
                    required
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                    placeholder="Nome"
                  />
                </div>

                <!-- Departamento -->
                <div class="sm:col-span-1 col-span-1">
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Departamento *</label>
                  <input 
                    type="text"
                    [(ngModel)]="registroEdicao.departamento"
                    name="departamento"
                    required
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                    placeholder="Depto"
                  />
                </div>

                <!-- Status -->
                <div class="sm:col-span-1 col-span-1">
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Status *</label>
                  <select 
                    [(ngModel)]="registroEdicao.status"
                    name="status"
                    required
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                  >
                    <option value="pendente">Pendente</option>
                    <option value="processando">Processando</option>
                    <option value="aprovado">Aprovado</option>
                    <option value="rejeitado">Rejeitado</option>
                  </select>
                </div>

                <!-- Valor Total -->
                <div class="sm:col-span-1 col-span-1">
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Valor (R$) *</label>
                  <input 
                    type="number"
                    [(ngModel)]="registroEdicao.valorTotal"
                    name="valorTotal"
                    required
                    step="0.01"
                    min="0"
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent"
                    placeholder="0,00"
                  />
                </div>

                <!-- Observa√ß√µes -->
                <div class="col-span-1 sm:col-span-2">
                  <label class="block text-xs font-medium text-[#1A4E79] mb-1">Observa√ß√µes</label>
                  <textarea 
                    [(ngModel)]="registroEdicao.observacoes"
                    name="observacoes"
                    rows="2"
                    class="w-full p-2 text-xs sm:text-sm border border-[#75C9C8]/30 rounded focus:ring-1 focus:ring-[#75C9C8] focus:border-transparent resize-none"
                    placeholder="Observa√ß√µes..."
                  ></textarea>
                </div>
              </div>
            </form>
          </div>

          <!-- Footer do Modal -->
          <div class="bg-gray-50 px-3 sm:px-4 py-3 rounded-b-lg flex flex-col sm:flex-row gap-2 justify-end">
            <button 
              type="button"
              (click)="cancelarEdicao()"
              class="w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm border border-gray-300 text-gray-700 rounded hover:bg-gray-100 transition-all order-2 sm:order-1"
            >
              <i class="po-icon po-icon-close mr-1"></i>
              Cancelar
            </button>
            <button 
              type="button"
              (click)="confirmarCopia()"
              [disabled]="!formEdicao.form.valid"
              class="w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm bg-gradient-to-r from-[#1A4E79] to-[#75C9C8] text-white rounded hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed order-1 sm:order-2"
            >
              <i class="po-icon po-icon-ok mr-1"></i>
              Confirmar
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </main>
</div>