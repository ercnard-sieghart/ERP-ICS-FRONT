<div class="menu-wrapper">
  <!-- Overlay para mobile - fecha o menu ao clicar fora -->
  <div 
    class="menu-overlay" 
    [class.active]="!isMenuCollapsed && isMobile"
    (click)="closeMenu()">
  </div>
  
  <!-- Sidebar principal - CORREÇÃO: adicionado rounded-r-2xl -->
  <aside 
    class="menu-sidebar rounded-r-2xl"
    [class.mobile-open]="!isMenuCollapsed && isMobile"
    [class.desktop-collapsed]="isMenuCollapsed && !isMobile"
    [class.desktop-expanded]="!isMenuCollapsed && !isMobile">
    
    <div class="menu-content">
      <!-- Cabeçalho do usuário -->
      <div class="user-section" *ngIf="!isMenuCollapsed || isMobile">
        <div class="flex flex-col items-center w-full">
          <img src="assets/logo.png" alt="Logo" class="h-16 w-16 object-contain mb-2" />
          <div class="user-info w-full justify-center">
            <div class="user-avatar">
              <po-icon name="an-user" size="sm" class="text-white"></po-icon>
            </div>
            <span class="user-name" [title]="userName">{{ userName }}</span>
          </div>
        </div>
        <button class="logout-btn" (click)="logout()">
          <po-icon name="exit" class="mr-1" size="sm"></po-icon>
          <span>Sair</span>
        </button>
      </div>
      
      <!-- Navegação -->
      <nav class="menu-nav">
        <ul class="menu-items">
          <li *ngFor="let item of menuItems">
            <div class="menu-group">
              <!-- Item sem submenu -->
              <a 
                *ngIf="!item.submenus || item.submenus.length === 0; else hasSubmenus"
                [href]="item.link" 
                class="menu-item menu-item-with-icon"
                [title]="isMenuCollapsed ? item.label : ''"
                (click)="handleMenuItemClick()">
                <span class="menu-icon">{{ getIconSymbol(item.icon) }}</span>
                <span class="menu-label" [class.hidden]="isMenuCollapsed && !isMobile">{{ item.label }}</span>
              </a>
              
              <!-- Item com submenu -->
              <ng-template #hasSubmenus>
                <button 
                  (click)="toggleSubmenu(item)"
                  class="submenu-toggle menu-item-with-icon"
                  [title]="isMenuCollapsed ? item.label : ''">
                  <div class="flex items-center flex-1 min-w-0">
                    <span class="menu-icon">{{ getIconSymbol(item.icon) }}</span>
                    <span class="menu-label" [class.hidden]="isMenuCollapsed && !isMobile">{{ item.label }}</span>
                  </div>
                  <span 
                    class="submenu-arrow"
                    [class.rotated]="item.expanded"
                    [class.hidden]="isMenuCollapsed && !isMobile"
                    *ngIf="!isMenuCollapsed || isMobile">▼</span>
                </button>
                
                <!-- Subitens -->
                <div 
                  class="submenu-items"
                  [class.max-h-0]="!item.expanded || (isMenuCollapsed && !isMobile)"
                  [class.max-h-96]="item.expanded && (!isMenuCollapsed || isMobile)">
                  <ul class="space-y-1">
                    <li *ngFor="let submenu of item.submenus">
                      <a 
                        [href]="submenu.link" 
                        class="submenu-item menu-item-with-icon"
                        [title]="submenu.label"
                        (click)="handleMenuItemClick()">
                        <span class="menu-icon text-xs">{{ getIconSymbol(submenu.icon) }}</span>
                        <span class="menu-label">{{ submenu.label }}</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </ng-template>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <!-- Botão Toggle -->
  <button 
    (click)="toggleMenu()" 
    [disabled]="isLoading"
    class="toggle-button"
    [class.desktop-collapsed]="isMenuCollapsed && !isMobile"
    [class.desktop-expanded]="!isMenuCollapsed && !isMobile">
    <span class="text-sm font-bold">☰</span>
  </button>
</div>