<div class="menu-wrapper">
  <!-- Overlay para mobile - fecha o menu ao clicar fora -->
  <div 
    class="menu-overlay" 
    [class.active]="!isMenuCollapsed && isMobile"
    (click)="closeMenu()">
  </div>
  
  <!-- Sidebar principal - CORREÇÃO: adicionado rounded-r-2xl -->
  <aside 
    class="menu-sidebar rounded-r-2xl"
    [class.mobile-open]="!isMenuCollapsed && isMobile"
    [class.desktop-collapsed]="isMenuCollapsed && !isMobile"
    [class.desktop-expanded]="!isMenuCollapsed && !isMobile">
    
    <div class="menu-content">
      <!-- Cabeçalho do usuário -->
      <div class="user-section" *ngIf="!isMenuCollapsed || isMobile">
        <div class="flex flex-col items-center w-full">
          <img src="assets/logo.png" alt="Logo" class="h-16 w-16 object-contain mb-2" />
          <div class="user-info w-full justify-center">
            <div class="flex items-center justify-center mb-2">
              <span class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-gradient-to-br from-[#1A4E79] to-[#75C9C8] shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 7.5a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 19.125A7.125 7.125 0 0112 12a7.125 7.125 0 017.5 7.125" />
                </svg>
              </span>
            </div>
            <span class="user-name block text-base font-semibold text-gray-800 text-center mb-1" [title]="userName">{{ userName }}</span>
          </div>
        </div>
        <div class="w-full flex justify-center">
          <div class="w-5/6 mt-2 py-4 px-4 rounded-xl bg-gradient-to-b from-white to-gray-100 shadow border border-gray-200 flex flex-col items-center">
            <button class="logout-btn w-full py-2 rounded-lg bg-gradient-to-r from-blue-50 to-cyan-50 hover:from-blue-100 hover:to-cyan-100 text-blue-700 font-medium flex items-center justify-center gap-2 shadow-sm transition-all border border-blue-100" (click)="logout()">
              <po-icon name="exit" class="mr-1" size="sm"></po-icon>
              <span>Sair</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Navegação -->
      <nav class="menu-nav">
        <ul class="menu-items">
          <li *ngFor="let item of menuItems">
            <div class="menu-group">
              <!-- Item sem submenu -->
              <a 
                *ngIf="!item.submenus || item.submenus.length === 0; else hasSubmenus"
                [href]="item.link" 
                class="menu-item menu-item-with-icon"
                [title]="isMenuCollapsed ? item.label : ''"
                (click)="handleMenuItemClick()">
                <span class="menu-icon">{{ getIconSymbol(item.icon) }}</span>
                <span class="menu-label" [class.hidden]="isMenuCollapsed && !isMobile">{{ item.label }}</span>
              </a>
              
              <!-- Item com submenu -->
              <ng-template #hasSubmenus>
                <button 
                  (click)="toggleSubmenu(item)"
                  class="submenu-toggle menu-item-with-icon"
                  [title]="isMenuCollapsed ? item.label : ''">
                  <div class="flex items-center flex-1 min-w-0">
                    <span class="menu-icon">{{ getIconSymbol(item.icon) }}</span>
                    <span class="menu-label" [class.hidden]="isMenuCollapsed && !isMobile">{{ item.label }}</span>
                  </div>
                  <span 
                    class="submenu-arrow"
                    [class.rotated]="item.expanded"
                    [class.hidden]="isMenuCollapsed && !isMobile"
                    *ngIf="!isMenuCollapsed || isMobile">▼</span>
                </button>
                
                <!-- Subitens -->
                <div 
                  class="submenu-items"
                  [class.max-h-0]="!item.expanded || (isMenuCollapsed && !isMobile)"
                  [class.max-h-96]="item.expanded && (!isMenuCollapsed || isMobile)">
                  <ul class="space-y-1">
                    <li *ngFor="let submenu of item.submenus">
                      <a 
                        [href]="submenu.link" 
                        class="submenu-item menu-item-with-icon"
                        [title]="submenu.label"
                        (click)="handleMenuItemClick()">
                        <span class="menu-icon text-xs">{{ getIconSymbol(submenu.icon) }}</span>
                        <span class="menu-label">{{ submenu.label }}</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </ng-template>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <!-- Botão Toggle -->
  <button 
    (click)="toggleMenu()" 
    [disabled]="isLoading"
    class="toggle-button"
    [class.desktop-collapsed]="isMenuCollapsed && !isMobile"
    [class.desktop-expanded]="!isMenuCollapsed && !isMobile">
    <span class="text-sm font-bold">☰</span>
  </button>
</div>